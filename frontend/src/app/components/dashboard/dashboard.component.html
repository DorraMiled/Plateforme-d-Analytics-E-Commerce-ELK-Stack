<div class="dashboard-container">
  <!-- Header -->
  <div class="page-header">
    <h1>
      <mat-icon>dashboard</mat-icon>
      Dashboard Principal
    </h1>
    <button mat-raised-button color="primary" (click)="refresh()" [disabled]="loading">
      <mat-icon>refresh</mat-icon>
      Actualiser
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && !stats" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Chargement des statistiques...</p>
  </div>

  <!-- Error State -->
  <mat-card *ngIf="error" class="error-card">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refresh()">Réessayer</button>
  </mat-card>

  <!-- KPI Cards -->
  <div *ngIf="stats" class="grid-container cols-4">
    <mat-card class="kpi-card primary">
      <mat-card-content>
        <div class="kpi-icon">
          <mat-icon>description</mat-icon>
        </div>
        <div class="kpi-value">{{ stats.total_logs | number }}</div>
        <div class="kpi-label">Total des Logs</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card success">
      <mat-card-content>
        <div class="kpi-icon">
          <mat-icon>today</mat-icon>
        </div>
        <div class="kpi-value">{{ stats.logs_today | number }}</div>
        <div class="kpi-label">Logs Aujourd'hui</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card error">
      <mat-card-content>
        <div class="kpi-icon">
          <mat-icon>error</mat-icon>
        </div>
        <div class="kpi-value">{{ stats.error_logs | number }}</div>
        <div class="kpi-label">Logs d'Erreur</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="kpi-card info">
      <mat-card-content>
        <div class="kpi-icon">
          <mat-icon>folder</mat-icon>
        </div>
        <div class="kpi-value">{{ stats.files_uploaded | number }}</div>
        <div class="kpi-label">Fichiers Uploadés</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts -->
  <div *ngIf="stats" class="grid-container cols-2">
    <!-- Bar Chart - Logs by Level -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>Distribution par Niveau</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas baseChart
            [type]="barChartType"
            [data]="barChartData"
            [options]="barChartOptions">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Line Chart - Logs over Time -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>Évolution Temporelle</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas baseChart
            [type]="lineChartType"
            [data]="lineChartData"
            [options]="lineChartOptions">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Recent Logs Table -->
  <mat-card *ngIf="stats && stats.recent_logs">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>history</mat-icon>
        Derniers Logs
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="stats.recent_logs" class="full-width">
          <!-- Timestamp Column -->
          <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef>Date/Heure</th>
            <td mat-cell *matCellDef="let log">
              {{ log.timestamp | date:'dd/MM/yyyy HH:mm:ss' }}
            </td>
          </ng-container>

          <!-- Level Column -->
          <ng-container matColumnDef="level">
            <th mat-header-cell *matHeaderCellDef>Niveau</th>
            <td mat-cell *matCellDef="let log">
              <span [class]="getLevelClass(log.level)">
                {{ log.level }}
              </span>
            </td>
          </ng-container>

          <!-- Service Column -->
          <ng-container matColumnDef="service">
            <th mat-header-cell *matHeaderCellDef>Service</th>
            <td mat-cell *matCellDef="let log">{{ log.service }}</td>
          </ng-container>

          <!-- Message Column -->
          <ng-container matColumnDef="message">
            <th mat-header-cell *matHeaderCellDef>Message</th>
            <td mat-cell *matCellDef="let log" class="message-cell">
              {{ log.message }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Quick Actions -->
  <div *ngIf="stats" class="quick-actions">
    <h2>Actions Rapides</h2>
    <div class="grid-container cols-3">
      <mat-card class="action-card" routerLink="/upload">
        <mat-icon color="primary">cloud_upload</mat-icon>
        <h3>Upload de Logs</h3>
        <p>Importer des fichiers CSV, JSON ou TXT</p>
      </mat-card>

      <mat-card class="action-card" routerLink="/search">
        <mat-icon color="primary">search</mat-icon>
        <h3>Rechercher</h3>
        <p>Filtrer et rechercher dans les logs</p>
      </mat-card>

      <mat-card class="action-card" routerLink="/results">
        <mat-icon color="primary">view_list</mat-icon>
        <h3>Voir Résultats</h3>
        <p>Analyser les logs indexés</p>
      </mat-card>
    </div>
  </div>
</div>
